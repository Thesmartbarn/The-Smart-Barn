<!DOCTYPE HTML>
<html>

<head>
	<script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="https://cdn.canvasjs.com/canvasjs.min.js"></script>
	<script type="text/javascript" src="average.js"></script>
	<script type="text/javascript">

		var chartPerMinute;
		var chartPerHour;
		var chartPerDay;
		var previousHour = getHour();
		var previousDay = getDay();
		var counter = 0
		var temperatureDataPointsPerMinute = [];
		var humidityDataPointsPerMinute = [];

		var temperatureDataPointsPerHour = [];
		var humidityDataPointsPerHour = [];

		var temperatureDataPointsPerDay = [];
		var humidityDataPointsPerDay = [];

		let graphType = {
			"graph1temp": true,
			"graph1hum": true,
			"graph2temp": true,
			"graph2hum": true,
			"graph3temp": true,
			"graph3hum": true
		}

		let newHourCheck = [false, false];
		let newDayCheck = [false, false];

		function renderEverything() {
			chartPerMinute.options.data[0].visible = graphType["graph1temp"];
			chartPerMinute.options.data[1].visible = graphType["graph1hum"];
			chartPerMinute.render();
			chartPerHour.options.data[0].visible = graphType["graph2temp"];
			chartPerHour.options.data[1].visible = graphType["graph2hum"];
			chartPerHour.render();
			chartPerDay.options.data[0].visible = graphType["graph3temp"];
			chartPerDay.options.data[1].visible = graphType["graph3hum"];
			chartPerDay.render();
		}

		function always2TimeDigits(unitToCheck) {
			if (unitToCheck < 10) {
				return '0' + unitToCheck;
			};
			return unitToCheck;
		}

		function checkBox(graphID) {
			graphType[graphID] = !graphType[graphID];
			renderEverything()
		}

		function getDataDateString() {
			const currentDateTime = new Date()
			let hours = currentDateTime.getHours();
			hours = always2TimeDigits(hours);
			let minutes = currentDateTime.getMinutes();
			minutes = always2TimeDigits(minutes);
			////
			let seconds = currentDateTime.getSeconds(); // seconds will be removed in final release
			seconds = always2TimeDigits(seconds); // same for this
			return `${hours}, ${minutes}, ${seconds}`;
		}

		function getHour() {
			var hour = new Date;
			return hour.getSeconds() // wordt verandert naar uur
		}

		function getDay() {
			var day = new Date;
			return day.getMinutes()
		}


		function checkIfNewHour() {
			if (getHour() != previousHour) {
				previousHour = getHour();
				return true;
			}
			return false;
		}

		function checkIfNewDay() {
			if (getDay() != previousDay) {
				previousDay = getDay();
				return true;
			}
			return false;
		}


		function getAndPlaceMinuteData(dataPointsPerMinute, dataPointsPerHour, dataPointsPerDay, minuteChart, hourChart, dayChart, graphTypePM, graphTypePH, graphTypePD, indexInData) {
			// $.getJSON("http://172.16.114.131:5000", function (data) { // school
			$.getJSON("http://192.168.0.246:5000", function (data) { // thuis laptop
				// $.getJSON("http://192.168.0.221:5000", function (data) { // thuis pc
				var yData = parseInt(data[indexInData])


				dataPointsPerMinute.push({
					x: counter, y: yData, label: getDataDateString()
				});

				if (dataPointsPerMinute.length > 60) {
					dataPointsPerMinute.splice(0, 1)
				}
				minuteChart.options.data[indexInData - 1].visible = graphType[graphTypePM];
				minuteChart.render();

				if (checkIfNewHour()) {
					newHourCheck = [true, true]
				}
				if (newHourCheck[indexInData - 1]) {
					getAndPlaceHourData(dataPointsPerMinute, dataPointsPerHour, dataPointsPerDay, hourChart, dayChart, graphTypePH, graphTypePD, indexInData);
					newHourCheck[indexInData - 1] = false;
				}

				counter++;
				setTimeout(() => {
					getAndPlaceMinuteData(dataPointsPerMinute, dataPointsPerHour, dataPointsPerDay, minuteChart, hourChart, dayChart, graphTypePM, graphTypePH, graphTypePD, indexInData)
				}, 100);
			})
		}

		function getAndPlaceHourData(dataPointsPerMinute, dataPointsPerHour, dataPointsPerDay, hourChart, dayChart, graphTypePH, graphTypePD, indexInData) {
			if (graphType[graphTypePH]) {
			}
			var yData = parseInt(averageOfList(dataPointsPerMinute));

			dataPointsPerHour.push({
				x: counter, y: yData, label: getDataDateString()
			});
			console.log(dataPointsPerHour);

			if (dataPointsPerHour.length > 24) {
				dataPointsPerHour.splice(0, 1);
			}
			if (checkIfNewDay()) {
				newDayCheck = [true, true];
			}
			if (newDayCheck[indexInData - 1]) {
				getAndPlaceDayData(dataPointsPerHour, dataPointsPerDay, dayChart, graphTypePD, indexInData);
				newDayCheck[indexInData - 1] = false;
			}

			hourChart.options.data[indexInData - 1].visible = graphType[graphTypePH];
			hourChart.render();
		}

		function getAndPlaceDayData(dataPointsPerHour, dataPointsPerDay, dayChart, graphTypePD, indexInData) {

			var yData = parseInt(averageOfList(dataPointsPerHour));

			dataPointsPerDay.push({
				x: counter, y: yData, label: getDataDateString()
			})

			if (dataPointsPerDay.length > 365) {
				dataPointsPerDay.splice(0, 1);
			}

			dayChart.options.data[indexInData - 1].visible = graphType[graphTypePD];
			dayChart.render();
		}


		window.onload = function () {

			chartPerMinute = new CanvasJS.Chart("chartPerMinute", {
				title: {
					text: "Data of the last hour"
				},
				data: [{
					type: "line",
					visible: graphType["graph1temp"],
					dataPoints: temperatureDataPointsPerMinute,

				}, {
					type: "line",
					visible: graphType["graph1hum"],
					dataPoints: humidityDataPointsPerMinute
				}],

				axisY: {
					minimum: 0,
					maximum: 100
				}

			});
			chartPerHour = new CanvasJS.Chart("chartPerHour", {
				title: {
					text: "Data of the last 24 hours"
				},
				data: [{
					type: "line",
					dataPoints: temperatureDataPointsPerHour,
				},
				{
					type: "line",
					dataPoints: humidityDataPointsPerHour
				}],
				axisY: {
					minimum: 0,
					maximum: 100
				}
			});

			chartPerDay = new CanvasJS.Chart("chartPerDay", {
				title: {
					text: "Data of the last year"
				},
				data: [{
					type: "line",

					dataPoints: temperatureDataPointsPerDay,
				},
				{
					type: "line",
					dataPoints: humidityDataPointsPerDay
				}],
				axisY: {
					minimum: 0,
					maximum: 100
				}
			});

			renderEverything();
			getAndPlaceMinuteData(temperatureDataPointsPerMinute, temperatureDataPointsPerHour, temperatureDataPointsPerDay, chartPerMinute, chartPerHour, chartPerDay, 'graph1temp', 'graph2temp', 'graph3temp', 1);
			getAndPlaceMinuteData(humidityDataPointsPerMinute, humidityDataPointsPerHour, humidityDataPointsPerDay, chartPerMinute, chartPerHour, chartPerDay, 'graph1hum', 'graph2hum', 'graph3hum', 2);
		}

	</script>

</head>

<body>
	<div id="chartPerMinute" style="height: 300px; width: 100%;"></div>
	<div class="checkBoxContainer">
		<label>display temperature</label>
		<input type="checkbox" class="checkBox" name="checkBox" onchange="checkBox('graph1hum')" checked>
		<label>display humidity</label>
		<input type="checkbox" class="checkBox" name="checkBox" onchange="checkBox('graph1temp')" checked>
	</div>

	<div id="chartPerHour" style="height: 300px; width: 100%;"></div>
	<div class="checkBoxContainer">
		<label>display temperature</label>
		<input type="checkbox" class="checkBox" name="checkBox" onchange="checkBox('graph2hum')" checked>
		<label>display humidity</label>
		<input type="checkbox" class="checkBox" name="checkBox" onchange="checkBox('graph2temp')" checked>
	</div>

	<div id="chartPerDay" style="height: 300px; width: 100%;"></div>
	<div class="checkBoxContainer">
		<label>display temperature</label>
		<input type="checkbox" class="checkBox" name="checkBox" onchange="checkBox('graph3hum')" checked>
		<label>display humidity</label>
		<input type="checkbox" class="checkBox" name="checkBox" onchange="checkBox('graph3temp')" checked>
	</div>

</body>

</html>