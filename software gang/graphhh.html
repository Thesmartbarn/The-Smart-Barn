<!DOCTYPE HTML>
<html>

<head>
	<script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="https://cdn.canvasjs.com/canvasjs.min.js"></script>
	<script type="text/javascript">


		let graphType = {
			"graph1temp": true,
			"graph1hum": true,
			"graph2temp": true,
			"graph2hum": true,
			"graph3temp": true,
			"graph3hum": true
		}

		function always2TimeDigits(unitToCheck) {
			if (unitToCheck < 10) {
				return '0' + unitToCheck;
			};
			return unitToCheck;
		}

		function checkBox(graphID) {
			graphType[graphID] = !graphType[graphID]
		}

		var counter = 0;
		function getAndPlaceDataOnChart(dataPoints, chart, graphID) {
			$.getJSON("http://127.0.0.1:5000", function (data) {
			    //$.getJSON("http://172.16.1.228:5000", function (data) {// 
				// $.getJSON("http://192.168.0.246:5000", function (data) {
				const currentDateTime = new Date()
				let hours = currentDateTime.getHours();
				hours = always2TimeDigits(hours);
				let minutes = currentDateTime.getMinutes();
				minutes = always2TimeDigits(minutes);
				let seconds = currentDateTime.getSeconds(); // seconds will be removed in final release
				seconds = always2TimeDigits(seconds) // same for this
				var currentTime = `${hours}.${minutes}.${seconds}`

				console.log(data);
				if (graphType[graphID]){
					yData = parseInt(data[1])
				} else {
					yData = -10
				}
				dataPoints.push({
					x: counter, y: yData, label: currentTime
				});
			
				if (dataPoints.length > 100) {
					dataPoints.splice(0, 1)
				}
				console.log(graphType[graphID])
				
				chart.render();
				
				counter++;
				setTimeout(() => {
					getAndPlaceDataOnChart(dataPoints, chart, graphID)
				}, 2000);
			});
		}
		window.onload = function () {
			var temperatureDataPointsPerHour = [];
			var humidityDataPointsPerHour = [];
			var temperatureDataPointsPerDay = [];
			var humidityDataPointsPerDay = [];




			var chartPerHour = new CanvasJS.Chart("temperatureChartContainer", {
				title: {
					text: "Data of the last hour"
				},
				data: [{
					type: "line",
					dataPoints: temperatureDataPointsPerHour,

				}, {
					type: "line",
					dataPoints: humidityDataPointsPerHour
				}],

				axisY: {
					minimum: 0,
					maximum: 100
				}

			}); var chartPerDay = new CanvasJS.Chart("humidityChartContainer", {
				title: {
					text: "Data of the last 24 hours"
				},
				data: [{
					type: "line",
					dataPoints: temperatureDataPointsPerDay,

				}, 
			{
				type: "line",
				dataPoints: humidityDataPointsPerDay
			}],
				axisY: {
					minimum: 0,
					maximum: 100
				}

			});

			getAndPlaceDataOnChart(temperatureDataPointsPerHour, chartPerHour, 'graph1temp');
			getAndPlaceDataOnChart(humidityDataPointsPerHour, chartPerHour, 'graph1hum');

			getAndPlaceDataOnChart(temperatureDataPointsPerDay, chartPerDay, 'graph2temp');
			getAndPlaceDataOnChart(humidityDataPointsPerDay, chartPerDay, 'graph3hum');

		}

	</script>

</head>

<body>
	<div id="temperatureChartContainer" style="height: 300px; width: 100%;"></div>
	<div class="checkBoxContainer">
		<label>display temperature</label>
		<input type="checkbox" class="checkBox" name="checkBox" onchange="checkBox('graph1temp')" checked>
		<label>display humidity</label>
		<input type="checkbox" class="checkBox" name="checkBox" onchange="checkBox('graph1hum')" checked>
	</div>
	<div id="humidityChartContainer" style="height: 300px; width: 100%;"></div>

</body>

</html>